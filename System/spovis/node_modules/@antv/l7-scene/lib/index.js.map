{"version":3,"sources":["../src/index.ts"],"names":["Scene","config","sceneService","mapService","controlService","layerService","iconService","markerService","popupService","container","id","map","logoPosition","logoVisible","sceneContainer","setContainer","bind","TYPES","IRendererService","to","ReglRendererService","inSingletonScope","get","ISceneService","IMapService","IIconService","IControlService","ILayerService","IMarkerService","IPopupService","initComponent","init","addControl","Logo","position","exportPng","layer","layerContainer","addLayer","getLayers","getLayer","name","getLayerByName","remove","removeAllLayers","render","img","addImage","hasImage","removeImage","ctr","removeControl","getControlByName","marker","addMarker","addMarkerLayer","removeMarkerLayer","removeAllMarkers","popup","addPopup","type","handle","SceneEventList","indexOf","on","off","getZoom","getCenter","getPitch","getRotation","getBounds","rotation","setRotation","zoomIn","zoomOut","p","panTo","pixel","zoom","setZoom","bound","fitBounds","center","setZoomAndCenter","style","setMapStyle","pixelToLngLat","lnglat","lngLatToPixel","containerToLngLat","lngLatToContainer","destroy","constructor","IPostProcessingPass","whenTargetNamed","DOM","getContainer"],"mappings":"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","sourcesContent":["import { Logo } from '@antv/l7-component';\nimport {\n  Bounds,\n  createLayerContainer,\n  createSceneContainer,\n  IControl,\n  IControlService,\n  IIconService,\n  IImage,\n  ILayer,\n  ILayerService,\n  ILngLat,\n  IMapService,\n  IMarker,\n  IMarkerLayer,\n  IMarkerService,\n  IPoint,\n  IPopup,\n  IPopupService,\n  IPostProcessingPass,\n  IRendererService,\n  ISceneConfig,\n  ISceneService,\n  Point,\n  SceneEventList,\n  TYPES,\n} from '@antv/l7-core';\nimport { ReglRendererService } from '@antv/l7-renderer';\nimport { DOM } from '@antv/l7-utils';\nimport { Container } from 'inversify';\nimport ILayerManager from './ILayerManager';\nimport IMapController from './IMapController';\nimport IPostProcessingPassPluggable from './IPostProcessingPassPluggable';\n\n/**\n * 暴露 Scene API\n *\n * @example\n * import { Scene } from 'l7/scene';\n * import { PointLayer } from 'l7/layers';\n *\n * const scene = new Scene();\n * const pointLayer = new PointLayer();\n * scene.addLayer(pointLayer);\n *\n */\nclass Scene\n  implements IPostProcessingPassPluggable, IMapController, ILayerManager {\n  private sceneService: ISceneService;\n  private mapService: IMapService<unknown>;\n  private controlService: IControlService;\n  private layerService: ILayerService;\n  private iconService: IIconService;\n  private markerService: IMarkerService;\n  private popupService: IPopupService;\n\n  private container: Container;\n\n  public constructor(config: ISceneConfig) {\n    const { id, map, logoPosition, logoVisible } = config;\n    // 创建场景容器\n    const sceneContainer = createSceneContainer();\n    this.container = sceneContainer;\n    // 绑定地图服务\n    map.setContainer(sceneContainer, id);\n\n    // 绑定渲染引擎服务\n    sceneContainer\n      .bind<IRendererService>(TYPES.IRendererService)\n      .to(ReglRendererService)\n      .inSingletonScope();\n\n    // 依赖注入\n    this.sceneService = sceneContainer.get<ISceneService>(TYPES.ISceneService);\n    this.mapService = sceneContainer.get<IMapService<unknown>>(\n      TYPES.IMapService,\n    );\n    this.iconService = sceneContainer.get<IIconService>(TYPES.IIconService);\n    this.controlService = sceneContainer.get<IControlService>(\n      TYPES.IControlService,\n    );\n    this.layerService = sceneContainer.get<ILayerService>(TYPES.ILayerService);\n\n    this.markerService = sceneContainer.get<IMarkerService>(\n      TYPES.IMarkerService,\n    );\n\n    this.popupService = sceneContainer.get<IPopupService>(TYPES.IPopupService);\n\n    this.initComponent(id);\n\n    // 初始化 scene\n    this.sceneService.init(config);\n    // TODO: 初始化组件\n    if (logoVisible) {\n      this.addControl(new Logo({ position: logoPosition }));\n    }\n  }\n\n  public getMapService(): IMapService<unknown> {\n    return this.mapService;\n  }\n  public exportPng(): string {\n    return this.sceneService.exportPng();\n  }\n\n  public get map() {\n    return this.mapService.map;\n  }\n\n  // layer 管理\n  public addLayer(layer: ILayer): void {\n    // 为当前图层创建一个容器\n    // TODO: 初始化的时候设置 容器\n    const layerContainer = createLayerContainer(this.container);\n    layer.setContainer(layerContainer);\n    this.sceneService.addLayer(layer);\n  }\n\n  public getLayers(): ILayer[] {\n    return this.layerService.getLayers();\n  }\n\n  public getLayer(id: string): ILayer | undefined {\n    return this.layerService.getLayer(id);\n  }\n\n  public getLayerByName(name: string): ILayer | undefined {\n    return this.layerService.getLayerByName(name);\n  }\n\n  public removeLayer(layer: ILayer): void {\n    this.layerService.remove(layer);\n  }\n\n  public removeAllLayer(): void {\n    this.layerService.removeAllLayers();\n  }\n\n  public render(): void {\n    this.sceneService.render();\n  }\n\n  // asset method\n  public addImage(id: string, img: IImage) {\n    this.iconService.addImage(id, img);\n  }\n\n  public hasImage(id: string) {\n    this.iconService.hasImage(id);\n  }\n\n  public removeImage(id: string) {\n    this.iconService.removeImage(id);\n  }\n\n  // map control method\n  public addControl(ctr: IControl) {\n    this.controlService.addControl(ctr, this.container);\n  }\n\n  public removeControl(ctr: IControl) {\n    this.controlService.removeControl(ctr);\n  }\n\n  public getControlByName(name: string) {\n    return this.controlService.getControlByName(name);\n  }\n\n  // marker\n  public addMarker(marker: IMarker) {\n    this.markerService.addMarker(marker);\n  }\n\n  public addMarkerLayer(layer: IMarkerLayer) {\n    this.markerService.addMarkerLayer(layer);\n  }\n\n  public removeMarkerLayer(layer: IMarkerLayer) {\n    this.markerService.removeMarkerLayer(layer);\n  }\n\n  public removeAllMakers() {\n    this.markerService.removeAllMarkers();\n  }\n\n  public addPopup(popup: IPopup) {\n    this.popupService.addPopup(popup);\n  }\n\n  public on(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.on(type, handle)\n      : this.sceneService.on(type, handle);\n  }\n\n  public off(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.off(type, handle)\n      : this.sceneService.off(type, handle);\n  }\n\n  // implements IMapController\n\n  public getZoom(): number {\n    return this.mapService.getZoom();\n  }\n\n  public getCenter(): ILngLat {\n    return this.mapService.getCenter();\n  }\n\n  public getPitch(): number {\n    return this.mapService.getPitch();\n  }\n\n  public getRotation(): number {\n    return this.mapService.getRotation();\n  }\n\n  public getBounds(): Bounds {\n    return this.mapService.getBounds();\n  }\n\n  public setRotation(rotation: number): void {\n    this.mapService.setRotation(rotation);\n  }\n  public zoomIn(): void {\n    this.mapService.zoomIn();\n  }\n\n  public zoomOut(): void {\n    this.mapService.zoomOut();\n  }\n\n  public panTo(p: Point): void {\n    this.mapService.panTo(p);\n  }\n\n  public panBy(pixel: Point): void {\n    this.mapService.panTo(pixel);\n  }\n\n  public setZoom(zoom: number): void {\n    this.mapService.setZoom(zoom);\n  }\n  public fitBounds(bound: Bounds): void {\n    this.mapService.fitBounds(bound);\n  }\n\n  public setZoomAndCenter(zoom: number, center: Point): void {\n    this.mapService.setZoomAndCenter(zoom, center);\n  }\n\n  public setMapStyle(style: string): void {\n    this.mapService.setMapStyle(style);\n  }\n\n  // conversion Method\n  public pixelToLngLat(pixel: Point): ILngLat {\n    return this.mapService.pixelToLngLat(pixel);\n  }\n\n  public lngLatToPixel(lnglat: Point): IPoint {\n    return this.mapService.lngLatToPixel(lnglat);\n  }\n\n  public containerToLngLat(pixel: Point): ILngLat {\n    return this.mapService.containerToLngLat(pixel);\n  }\n\n  public lngLatToContainer(lnglat: Point): IPoint {\n    return this.mapService.lngLatToContainer(lnglat);\n  }\n\n  public destroy() {\n    this.sceneService.destroy();\n    // TODO: 清理其他 Service 例如 IconService\n  }\n\n  public registerPostProcessingPass(\n    constructor: new (...args: any[]) => IPostProcessingPass<unknown>,\n    name: string,\n  ) {\n    this.container\n      .bind<IPostProcessingPass<unknown>>(TYPES.IPostProcessingPass)\n      .to(constructor)\n      .whenTargetNamed(name);\n  }\n\n  private initComponent(id: string | HTMLDivElement) {\n    this.controlService.init(\n      {\n        container: DOM.getContainer(id),\n      },\n      this.container,\n    );\n    this.markerService.init(this.container);\n    this.popupService.init(this.container);\n  }\n  // 资源管理\n}\n\nexport { Scene };\n"],"file":"index.js"}